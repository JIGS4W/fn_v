<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <title>Login - Cafe POS</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600&display=swap" rel="stylesheet">
    
<style>
        body { font-family: 'Kanit', sans-serif; }
        
        /* Loader Styles (Dark Theme Version) */
        .loader-overlay {
            position: fixed; inset: 0; z-index: 9999;
            background: rgba(28, 25, 23, 0.95); /* Dark background */
            backdrop-filter: blur(8px);
            display: flex; justify-content: center; align-items: center;
        }
        .loader { width: 100px; height: 100px; position: relative; animation: shake 3s infinite ease-in-out; }
        .cup { position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%); width: 40px; height: 30px; background-color: #d6d3d1; border-radius: 0 0 15px 15px; z-index: 1; animation: cupPulse 6s infinite ease-in-out; }
        .cup::after { content: ""; position: absolute; top: -5px; left: 0; width: 100%; height: 10px; background: #d97706; border-radius: 50%; animation: coffeeGlow 6s infinite ease-in-out; }
        .cup-handle { position: absolute; top: 5px; right: -12px; width: 12px; height: 18px; border: 3px solid #d6d3d1; border-left: none; border-radius: 0 10px 10px 0; }
        .smoke { position: absolute; bottom: 100%; left: 50%; width: 8px; height: 20px; background: rgba(255, 255, 255, 0.3); border-radius: 50%; transform: translateX(-50%); animation: rise 2.5s infinite ease-in-out; filter: blur(4px); }
        .smoke.one { animation-delay: 0s; } .smoke.two { animation-delay: 0.6s; } .smoke.three { animation-delay: 1.2s; }
        .load { position: absolute; bottom: -20px; left: 50%; transform: translateX(-50%); font-size: 14px; color: #a8a29e; font-weight: 500; width: 200px; text-align: center; letter-spacing: 0.5px; }
        
        @keyframes rise { 0% { transform: translate(-50%, 0) scale(0.4); opacity: 0; } 30% { opacity: 0.8; } 60% { opacity: 0.5; } 100% { transform: translate(-50%, -60px) scale(1.2); opacity: 0; } }
        @keyframes shake { 0% { transform: rotate(0); } 25% { transform: rotate(-3deg); } 50% { transform: rotate(0); } 75% { transform: rotate(3deg); } 100% { transform: rotate(0); } }
        @keyframes cupPulse { 0%, 100% { background-color: #44403c; } 50% { background-color: #57534e; } }
        @keyframes coffeeGlow { 0%, 100% { background: #d97706; } 50% { background: #f59e0b; } }

        /* Modal Animation */
        @keyframes popIn { 0% { transform: scale(0.95) translateY(10px); opacity: 0; } 100% { transform: scale(1) translateY(0); opacity: 1; } }
        .modal-box { animation: popIn 0.3s cubic-bezier(0.34, 1.56, 0.64, 1); }
        .fade-enter-active, .fade-leave-active { transition: opacity 0.3s ease, transform 0.3s ease; }
        .fade-enter-from, .fade-leave-to { opacity: 0; transform: translateY(-10px); }
    </style>
</head>
<body class="bg-gradient-to-br from-[#1c1917] via-[#292524] to-[#78350f] h-screen flex items-center justify-center p-4">
    <div class="fixed inset-0 z-0 opacity-10 pointer-events-none" style="background-image: radial-gradient(#ffffff 1px, transparent 1px); background-size: 32px 32px;"></div>

    <div id="app" class="w-full max-w-sm relative z-10">

        <div v-if="isLoading" class="loader-overlay">
            <div class="loader">
                <div class="cup">
                    <div class="cup-handle"></div>
                    <div class="smoke one"></div>
                    <div class="smoke two"></div>
                    <div class="smoke three"></div>
                </div>
                <div class="load">กำลังตรวจสอบข้อมูล...</div>
            </div>
        </div>

        <div v-if="showErrorModal" class="fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm p-4" @click.self="showErrorModal = false">
            <div class="bg-white rounded-2xl shadow-2xl p-6 max-w-xs w-full text-center modal-box border-t-4 border-red-500">
                <div class="w-14 h-14 bg-red-50 rounded-full flex items-center justify-center mx-auto mb-4 text-red-500 shadow-sm">
                    <i class="fa-solid fa-circle-exclamation text-2xl"></i>
                </div>
                <h3 class="text-lg font-bold text-gray-800 mb-2">เข้าสู่ระบบไม่สำเร็จ</h3>
                <p class="text-gray-500 mb-6 text-sm leading-relaxed">ข้อมูลไม่ถูกต้อง<br>กรุณาตรวจสอบอีกครั้ง</p>
                <button @click="showErrorModal = false" class="w-full bg-stone-800 hover:bg-stone-900 text-white font-medium py-2.5 rounded-lg transition active:scale-95 text-sm">
                    ตกลง
                </button>
            </div>
        </div>

<div class="bg-white/95 backdrop-blur-sm rounded-3xl shadow-2xl overflow-hidden relative border border-white/20">
            
            <div class="bg-gradient-to-r from-[#292524] to-[#44403c] pt-10 pb-8 px-8 text-center relative overflow-hidden">
                <div class="absolute inset-0 opacity-10">
                    <i class="fa-solid fa-mug-hot absolute top-4 left-4 text-6xl text-white transform -rotate-12"></i>
                    <i class="fa-solid fa-coffee-bean absolute bottom-[-10px] right-[-10px] text-8xl text-white opacity-50"></i>
                </div>

                <div class="relative z-10 flex flex-col items-center">
                    <div class="w-16 h-16 bg-gradient-to-tr from-amber-500 to-yellow-500 rounded-2xl flex items-center justify-center shadow-lg shadow-amber-500/20 mb-4 text-white text-3xl rotate-3 ring-4 ring-white/10">
                        <i class="fa-solid fa-mug-saucer"></i>
                    </div>
                    <h1 class="text-2xl font-bold text-white tracking-wide font-kanit drop-shadow-md">CAFE POS</h1>
                    <p class="text-stone-300 text-xs mt-1 font-light tracking-widest uppercase">Management System</p>
                </div>
            </div>
            
            <div class="p-8 space-y-6">
                <div>
                    <label class="block text-stone-500 text-xs font-semibold mb-3 ml-1 uppercase tracking-wider">เลือกการใช้งาน</label>
                    <div class="grid grid-cols-2 gap-3">
                        <label class="cursor-pointer group">
                            <input type="radio" v-model="role" value="guest" class="hidden peer">
                            <div class="border border-stone-200 rounded-xl p-3 text-center transition-all duration-200 
                                        peer-checked:border-amber-500 peer-checked:bg-amber-50 peer-checked:text-amber-700 peer-checked:shadow-md
                                        group-hover:border-amber-300 group-hover:bg-stone-50">
                                <div class="text-2xl mb-1 text-stone-400 peer-checked:text-amber-500 transition-colors">
                                    <i class="fa-solid fa-user"></i>
                                </div>
                                <div class="font-medium text-sm text-stone-600 peer-checked:text-amber-800">ลูกค้า</div>
                            </div>
                        </label>
                        <label class="cursor-pointer group">
                            <input type="radio" v-model="role" value="admin" class="hidden peer">
                            <div class="border border-stone-200 rounded-xl p-3 text-center transition-all duration-200 
                                        peer-checked:border-amber-500 peer-checked:bg-amber-50 peer-checked:text-amber-700 peer-checked:shadow-md
                                        group-hover:border-amber-300 group-hover:bg-stone-50">
                                <div class="text-2xl mb-1 text-stone-400 peer-checked:text-amber-500 transition-colors">
                                    <i class="fa-solid fa-user-tie"></i>
                                </div>
                                <div class="font-medium text-sm text-stone-600 peer-checked:text-amber-800">พนักงาน</div>
                            </div>
                        </label>
                    </div>
                </div>

                <transition name="fade">
                    <div v-if="role === 'admin'" class="space-y-4">
                        <div class="relative group">
                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                <i class="fa-solid fa-users text-stone-400 group-focus-within:text-amber-600 transition-colors"></i>
                            </div>
                            <input v-model="username" type="text" :class="{'border-red-500 bg-red-50 text-red-900': isError}"
                                    class="w-full bg-stone-50 text-stone-800 border border-stone-200 rounded-lg py-3 pl-10 pr-3 text-sm focus:outline-none focus:border-amber-500 focus:ring-1 focus:ring-amber-500 transition-all placeholder-stone-400" 
                                    placeholder="Username">
                        </div>
                        <div class="relative group">
                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                <i class="fa-solid fa-lock text-stone-400 group-focus-within:text-amber-600 transition-colors"></i>
                            </div>
                            <input v-model="password" type="password" @keyup.enter="handleLogin" :class="{'border-red-500 bg-red-50 text-red-900': isError}" 
                                    class="w-full bg-stone-50 text-stone-800 border border-stone-200 rounded-lg py-3 pl-10 pr-3 text-sm focus:outline-none focus:border-amber-500 focus:ring-1 focus:ring-amber-500 transition-all placeholder-stone-400" 
                                    placeholder="Password">
                        </div>
                    </div>
                </transition>

                <button @click="handleLogin" class="w-full bg-gradient-to-r from-amber-700 to-amber-600 hover:from-amber-800 hover:to-amber-700 text-white font-medium py-3.5 rounded-xl shadow-lg shadow-amber-600/30 transition-all transform hover:-translate-y-0.5 active:scale-95 flex justify-center items-center gap-3 group">
                    <span>เข้าสู่ระบบ</span>
                    <i class="fa-solid fa-arrow-right-to-bracket text-amber-200 group-hover:text-white transition-colors"></i>
                </button>
            </div>
            
            <div class="bg-stone-50 p-4 text-center border-t border-stone-100">
                <p class="text-[10px] text-stone-400 font-light">
                    &copy; 2024 Cafe POS System. All rights reserved.
                </p>
            </div>
        </div>
    </div>

    <script>
        const { createApp } = Vue
        createApp({
            data() {
                return {
                    role: 'guest',
                    username: '',
                    password: '',
                    isLoading: false,
                    showErrorModal: false,
                    isError: false
                }
            },
            watch: {
                role(newVal) {
                    if (newVal === 'guest') {
                        this.username = ''; this.password = ''; this.isError = false;
                    }
                },
                username() { if(this.isError) this.isError = false; },
                password() { if(this.isError) this.isError = false; }
            },
            methods: {
                async handleLogin() {
                    // 1. ถ้าเป็น Guest
                    if (this.role === 'guest') {
                        this.startLoading('guest.html');
                        return;
                    }

                    // 2. ถ้าเป็น Admin แต่กรอกไม่ครบ
                    if (!this.username || !this.password) {
                        this.showErrorModal = true;
                        this.isError = true;
                        return;
                    }

                    // 3. ✅ ยิง API ไปถาม Server (Secure Login)
                    try {
                        const response = await fetch('/api/login', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                username: this.username,
                                password: this.password,
                            })
                        });

                        const result = await response.json();

                        if (result.success) {
                            if (result.token) {
                                localStorage.setItem('adminToken', result.token);
                            }
                            this.startLoading('admin.html');
                        } else {
                            this.showErrorModal = true;
                            this.isError = true;
                        }
                    } catch (error) {
                        alert('ไม่สามารถเชื่อมต่อ Server ได้');
                        console.error(error);
                    }
                },
                startLoading(url) {
                    this.isLoading = true;
                    setTimeout(() => {
                        window.location.href = url;
                    }, 1500);
                }
            }
        }).mount('#app')
    </script>
</body>
</html>